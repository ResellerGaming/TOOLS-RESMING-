<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <title>ImgEdit – Space Dark-Matter</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
  @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@300;500;700&display=swap');
  :root{
    --prime:#8a2be2;
    --second:#4b0082;
    --accent:#00bfff;
    --dark:#010107;
    --stars:200;
  }
  *{box-sizing:border-box;margin:0;padding:0;font-family:'Exo 2',sans-serif}
  body{
    height:100vh;
    overflow:hidden;
    background:var(--dark);
    display:flex;align-items:center;justify-content:center;
    perspective:1200px;
  }
  /* ---------- parallax starfield ---------- */
  .stars{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none}
  .stars span{
    position:absolute;width:2px;height:2px;background:#fff;border-radius:50%;
    animation:move 120s linear infinite;
    box-shadow:0 0 4px #fff;
  }
  @keyframes move{
    from{transform:translateY(0)}
    to{transform:translateY(-200vh)}
  }

  /* ---------- card ---------- */
  .card{
    width:90%;max-width:400px;
    background:rgba(30,30,60,.35);
    backdrop-filter:blur(12px);
    border:1px solid rgba(138,43,226,.4);
    border-radius:20px;
    padding:2rem;
    position:relative;
    animation:float 6s ease-in-out infinite;
    box-shadow:0 0 40px rgba(138,43,226,.25);
  }
  @keyframes float{
    0%,100%{transform:translateY(0) rotate(.2deg)}
    50%{transform:translateY(-10px) rotate(-.2deg)}
  }
  .logo{
    text-align:center;color:#fff;font-size:1.6rem;font-weight:700;letter-spacing:2px;
    margin-bottom:1.2rem;
  }
  .logo i{margin-right:.5rem;color:var(--accent);animation:pulse 2s infinite}
  @keyframes pulse{
    50%{transform:scale(1.15);text-shadow:0 0 15px var(--accent)}
  }

  /* ---------- toggle ---------- */
  .toggle{display:flex;background:rgba(0,0,0,.3);border-radius:30px;padding:4px;margin-bottom:1.2rem}
  .toggle button{flex:1;border:none;background:transparent;color:#fff;padding:.5rem 0;border-radius:30px;cursor:pointer;transition:.3s}
  .toggle button.active{background:var(--prime);box-shadow:0 0 15px var(--prime)}

  /* ---------- drop ---------- */
  .drop-area{
    border:2px dashed rgba(138,43,226,.5);border-radius:15px;padding:2rem 1rem;text-align:center;color:#fff;
    transition:.3s;position:relative;overflow:hidden;
  }
  .drop-area.dragover{border-color:var(--accent);background:rgba(0,191,255,.1);transform:scale(1.02)}
  .drop-area input[type=file]{position:absolute;width:100%;height:100%;left:0;top:0;opacity:0;cursor:pointer}
  #fileName{font-size:.9rem;margin-top:.5rem;color:var(--accent)}

  /* ---------- prompt ---------- */
  #promptBox{margin:1rem 0 1.2rem}
  .promptInp{
    width:100%;padding:.7rem 1rem;border-radius:30px;border:none;outline:none;
    background:rgba(255,255,255,.08);color:#fff;transition:.3s
  }
  .promptInp:focus{box-shadow:0 0 15px var(--accent)}

  /* ---------- button ---------- */
  .btn{
    width:100%;padding:.8rem;border:none;border-radius:30px;
    background:linear-gradient(90deg,var(--prime),var(--second));color:#fff;font-weight:600;
    cursor:pointer;position:relative;overflow:hidden;transition:.3s;
  }
  .btn:hover{transform:scale(1.03);box-shadow:0 0 25px var(--prime)}
  .btn:disabled{filter:grayscale(1);cursor:not-allowed}
  .btn i{margin-right:.4rem}
  /* orbit ring */
  .btn::after{
    content:'';position:absolute;top:50%;left:50%;width:300%;height:300%;
    border:2px solid rgba(138,43,226,.4);border-radius:50%;
    transform:translate(-50%,-50%) scale(0);animation:orbit 4s linear infinite;
    transition:transform .5s;
  }
  .btn:hover::after{transform:translate(-50%,-50%) scale(1)}
  @keyframes orbit{to{transform:translate(-50%,-50%) scale(1) rotate(360deg)}}

  /* ---------- progress ---------- */
  .progress-box{color:#fff;font-size:.9rem;margin-top:1rem}
  .bar{width:100%;height:6px;background:rgba(255,255,255,.1);border-radius:3px;overflow:hidden}
  .bar div{height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--prime));box-shadow:0 0 10px var(--accent);transition:width .3s}

  /* ---------- result ---------- */
  #resultBox{text-align:center;margin-top:1.2rem;animation:warpIn .8s}
  @keyframes warpIn{
    from{opacity:0;transform:scale(.5) rotate(-10deg)}
    to{opacity:1;transform:scale(1) rotate(0)}
  }
  #resultImg{width:100%;border-radius:15px;box-shadow:0 0 30px rgba(138,43,226,.4)}
  .downBtn{margin-top:.8rem;display:inline-block;padding:.6rem 1.4rem;background:#fff;color:var(--dark);border-radius:30px;text-decoration:none;font-weight:600;transition:.3s}
  .downBtn:hover{background:var(--accent);color:#fff;box-shadow:0 0 15px var(--accent)}

  .hidden{display:none}
  </style>
</head>
<body>
  <!-- starfield -->
  <div class="stars" id="stars"></div>

  <div class="card">
    <div class="logo"><i class="fa-solid fa-rocket"></i> Image edit</div>

    <div class="toggle">
      <button class="active" data-mode="edit">Img Custom</button>
      <button data-mode="chibi">To Chibi</button>
      <button data-mode="figure">To Figure</button>
    </div>

    <div id="error" class="hidden" style="color:#ff99cc;font-size:.85rem;margin-bottom:.8rem"></div>

    <form id="form">
      <div class="drop-area" id="dropArea">
        <i class="fa-solid fa-cloud-moon fa-2x" style="color:#fff"></i>
        <p>Upload & lepas gambar ke orbit</p>
        <input type="file" id="fileInp" accept="image/*" required>
        <div id="fileName"></div>
      </div>

      <div id="promptBox">
        <input class="promptInp" id="promptInp" placeholder="Prompt atau teks edit image">
      </div>

      <button class="btn" id="submitBtn" type="submit">
        <i class="fa-solid fa-paper-plane"></i> start
      </button>
    </form>

    <div id="progressBox" class="progress-box hidden">
      Warping…
      <div class="bar"><div id="bar"></div></div>
    </div>

    <div id="resultBox" class="hidden">
      <img id="resultImg" src="" alt="result">
      <br>
      <a class="downBtn" id="downBtn" href="#" download="result.png">
        <i class="fa-solid fa-download"></i> Download
      </a>
    </div>
  </div>

<script>
/* ---------- generate starfield ---------- */
const stars=document.getElementById('stars');
for(let i=0;i<120;i++){
  const s=document.createElement('span');
  s.style.left=Math.random()*100+'%';
  s.style.top=Math.random()*100+'%';
  s.style.animationDelay=Math.random()*120+'s';
  s.style.width=s.style.height=Math.random()*2.5+'px';
  stars.appendChild(s);
}

/* ---------- logic ---------- */
const dropArea=document.getElementById('dropArea');
const fileInp=document.getElementById('fileInp');
const fileName=document.getElementById('fileName');
const promptBox=document.getElementById('promptBox');
const form=document.getElementById('form');
const submitBtn=document.getElementById('submitBtn');
const progressBox=document.getElementById('progressBox');
const bar=document.getElementById('bar');
const resultBox=document.getElementById('resultBox');
const resultImg=document.getElementById('resultImg');
const downBtn=document.getElementById('downBtn');
const error=document.getElementById('error');

let mode='edit';
document.querySelectorAll('.toggle button').forEach(b=>{
  b.addEventListener('click',()=>{
    document.querySelectorAll('.toggle button').forEach(btn=>btn.classList.remove('active'));
    b.classList.add('active'); mode=b.dataset.mode;
    promptBox.style.display=mode==='edit'?'block':'none';
  })
});

/* drag-drop */
;['dragenter','dragover','dragleave','drop'].forEach(evt=>{
  dropArea.addEventListener(evt,e=>{e.preventDefault();e.stopPropagation()});
});
['dragenter','dragover'].forEach(evt=>{
  dropArea.addEventListener(evt,()=>dropArea.classList.add('dragover'))
});
['dragleave','drop'].forEach(evt=>{
  dropArea.addEventListener(evt,()=>dropArea.classList.remove('dragover'))
});
dropArea.addEventListener('drop',e=>{
  const f=e.dataTransfer.files[0]; if(f&&f.type.startsWith('image')){fileInp.files=e.dataTransfer.files;changeFile()}
});
fileInp.addEventListener('change',changeFile);
function changeFile(){
  const f=fileInp.files[0];
  fileName.textContent=f?f.name:'';
}

form.addEventListener('submit',async e=>{
  e.preventDefault();
  error.classList.add('hidden');
  const f=fileInp.files[0];
  if(!f)return err('Pilih gambar terlebih dahulu!');
  if(mode==='edit'&&!promptInp.value.trim())return err('Prompt tidak boleh kosong!');
  submitBtn.disabled=true; progressBox.classList.remove('hidden'); resultBox.classList.add('hidden');
  animateBar();
  try{
    const url=await upload(f);
    let api='';
    if(mode==='edit')api=`https://api.fikmydomainsz.xyz/ai/nanobnna?url=${encodeURIComponent(url)}&prompt=${encodeURIComponent(promptInp.value.trim())}`;
    else if(mode==='chibi')api=`https://api.fikmydomainsz.xyz/imagecreator/tochibi?url=${encodeURIComponent(url)}`;
    else api=`https://api.fikmydomainsz.xyz/imagecreator/tofigur?url=${encodeURIComponent(url)}`;
    const res=await fetch(api); const j=await res.json();
    if(!j.status||!j.result)throw new Error(j.message||'API error');
    resultImg.src=j.result; downBtn.href=j.result;
    progressBox.classList.add('hidden'); resultBox.classList.remove('hidden');
  }catch(e){err(e.message||'Gagal proses'); progressBox.classList.add('hidden')}
  finally{submitBtn.disabled=false}
});

async function upload(f){
  const fd=new FormData(); fd.append('files',f,f.name);
  const r=await fetch('https://cdn.yupra.my.id/upload',{method:'POST',body:fd,headers:{'User-Agent':'Mozilla/5.0'}});
  const j=await r.json(); if(j.success&&j.files?.[0])return 'https://cdn.yupra.my.id'+j.files[0].url; throw new Error('Upload gagal')
}
function animateBar(){let w=0; bar.style.width='0'; const t=setInterval(()=>{w+=Math.random()*18; if(w>=90){clearInterval(t);w=90} bar.style.width=w+'%'},300)}
function err(m){error.textContent=m; error.classList.remove('hidden')}
</script>
</body>
  </html>
